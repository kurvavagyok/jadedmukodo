
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JADED - Fejlett Komponensek</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/lib/codemirror.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ngl@2.0.0-dev.37/dist/ngl.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/lib/codemirror.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/theme/dracula.css">
    <style>
        .component-container {
            margin: 20px;
            padding: 20px;
            border-radius: 12px;
            background: var(--surface);
            border: 1px solid var(--border);
        }
        .sequence-input {
            width: 100%;
            min-height: 120px;
            font-family: 'Courier New', monospace;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            color: var(--text);
            resize: vertical;
        }
        .validation-message {
            margin-top: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .validation-error {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.3);
            color: #ff3b30;
        }
        .validation-success {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.3);
            color: #34c759;
        }
        .mutation-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .mutation-table th,
        .mutation-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .mutation-table th {
            background: var(--glass);
            font-weight: 600;
        }
        .pathogenicity-score {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        .score-high { background: rgba(255, 59, 48, 0.2); color: #ff3b30; }
        .score-medium { background: rgba(255, 149, 0, 0.2); color: #ff9500; }
        .score-low { background: rgba(52, 199, 89, 0.2); color: #34c759; }
        .code-editor-container {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
        .progress-container {
            background: var(--glass);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .dashboard-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        .language-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .btn {
            background: var(--glass-strong);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 16px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: var(--glass-ultra);
            border-color: var(--primary);
        }
        .btn-primary {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        .filter-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .contact-map-container {
            width: 100%;
            height: 400px;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="language-switch">
        <select id="languageSelect" class="btn">
            <option value="hu">Magyar</option>
            <option value="en">English</option>
        </select>
    </div>

    <div id="sequence-analyzer"></div>
    <div id="mutation-analyzer"></div>
    <div id="code-generator"></div>
    <div id="contact-map-viewer"></div>
    <div id="dashboard"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Nyelvkezelés
        const translations = {
            hu: {
                sequenceAnalyzer: "Szekvencia Analizáló",
                enterSequence: "Adja meg a szekvenciát:",
                sequenceType: "Szekvencia típusa:",
                protein: "Protein",
                dna: "DNS",
                rna: "RNS",
                analyze: "Elemzés",
                validSequence: "Érvényes szekvencia",
                invalidSequence: "Érvénytelen szekvencia",
                mutationAnalyzer: "Mutáció Elemző",
                proteinSequence: "Protein szekvencia:",
                mutations: "Mutációk:",
                pathogenicity: "Patogenitás",
                confidence: "Megbízhatóság",
                codeGenerator: "Kód Generátor",
                codeDescription: "Kód leírása:",
                language: "Nyelv:",
                generateCode: "Kód generálása",
                contactMaps: "Kontakt Térképek",
                dashboard: "Irányítópult",
                runningAnalyses: "Futó elemzések"
            },
            en: {
                sequenceAnalyzer: "Sequence Analyzer",
                enterSequence: "Enter sequence:",
                sequenceType: "Sequence type:",
                protein: "Protein",
                dna: "DNA",
                rna: "RNA",
                analyze: "Analyze",
                validSequence: "Valid sequence",
                invalidSequence: "Invalid sequence",
                mutationAnalyzer: "Mutation Analyzer",
                proteinSequence: "Protein sequence:",
                mutations: "Mutations:",
                pathogenicity: "Pathogenicity",
                confidence: "Confidence",
                codeGenerator: "Code Generator",
                codeDescription: "Code description:",
                language: "Language:",
                generateCode: "Generate Code",
                contactMaps: "Contact Maps",
                dashboard: "Dashboard",
                runningAnalyses: "Running Analyses"
            }
        };

        // Szekvencia Analizáló Komponens
        function SequenceAnalyzer() {
            const [sequence, setSequence] = useState('');
            const [sequenceType, setSequenceType] = useState('protein');
            const [validation, setValidation] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [language, setLanguage] = useState('hu');

            const t = translations[language];

            useEffect(() => {
                const langSelect = document.getElementById('languageSelect');
                const handleLanguageChange = (e) => setLanguage(e.target.value);
                langSelect.addEventListener('change', handleLanguageChange);
                return () => langSelect.removeEventListener('change', handleLanguageChange);
            }, []);

            const validateSequence = async (seq, type) => {
                if (!seq.trim()) {
                    setValidation(null);
                    return;
                }

                try {
                    const response = await fetch('/api/alphafold3/sequence_validation', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sequence: seq, type })
                    });
                    const result = await response.json();
                    setValidation(result);
                } catch (error) {
                    setValidation({ valid: false, message: 'Validation error' });
                }
            };

            useEffect(() => {
                const timeoutId = setTimeout(() => {
                    if (sequence) validateSequence(sequence, sequenceType);
                }, 500);
                return () => clearTimeout(timeoutId);
            }, [sequence, sequenceType]);

            const handleAnalyze = async () => {
                setIsAnalyzing(true);
                try {
                    const response = await fetch('/api/alphafold3/comprehensive_analysis', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sequence, type: sequenceType })
                    });
                    const result = await response.json();
                    console.log('Analysis result:', result);
                } catch (error) {
                    console.error('Analysis error:', error);
                } finally {
                    setIsAnalyzing(false);
                }
            };

            return (
                <div className="component-container">
                    <h2>{t.sequenceAnalyzer}</h2>
                    <div style={{ marginBottom: '16px' }}>
                        <label>{t.sequenceType}</label>
                        <select 
                            value={sequenceType} 
                            onChange={(e) => setSequenceType(e.target.value)}
                            className="btn"
                            style={{ marginLeft: '8px' }}
                        >
                            <option value="protein">{t.protein}</option>
                            <option value="dna">{t.dna}</option>
                            <option value="rna">{t.rna}</option>
                        </select>
                    </div>
                    <textarea
                        className="sequence-input"
                        placeholder={t.enterSequence}
                        value={sequence}
                        onChange={(e) => setSequence(e.target.value.toUpperCase())}
                    />
                    {validation && (
                        <div className={`validation-message ${validation.valid ? 'validation-success' : 'validation-error'}`}>
                            {validation.valid ? t.validSequence : t.invalidSequence}: {validation.message}
                        </div>
                    )}
                    <button 
                        className="btn btn-primary" 
                        onClick={handleAnalyze}
                        disabled={!validation?.valid || isAnalyzing}
                        style={{ marginTop: '16px' }}
                    >
                        {isAnalyzing ? 'Analyzing...' : t.analyze}
                    </button>
                </div>
            );
        }

        // Mutáció Elemző Komponens
        function MutationAnalyzer() {
            const [proteinSequence, setProteinSequence] = useState('');
            const [mutations, setMutations] = useState('');
            const [results, setResults] = useState([]);
            const [filter, setFilter] = useState('all');
            const [language, setLanguage] = useState('hu');

            const t = translations[language];

            useEffect(() => {
                const langSelect = document.getElementById('languageSelect');
                const handleLanguageChange = (e) => setLanguage(e.target.value);
                langSelect.addEventListener('change', handleLanguageChange);
                return () => langSelect.removeEventListener('change', handleLanguageChange);
            }, []);

            const analyzeMutations = async () => {
                try {
                    const mutationList = mutations.split(',').map(m => m.trim()).filter(m => m);
                    const response = await fetch('/api/alphamissense/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            protein_sequence: proteinSequence,
                            mutations: mutationList
                        })
                    });
                    const result = await response.json();
                    setResults(result.mutation_analysis?.results || []);
                } catch (error) {
                    console.error('Mutation analysis error:', error);
                }
            };

            const getScoreClass = (score) => {
                if (score >= 0.7) return 'score-high';
                if (score >= 0.4) return 'score-medium';
                return 'score-low';
            };

            const filteredResults = results.filter(result => {
                if (filter === 'all') return true;
                if (filter === 'pathogenic') return result.pathogenic;
                if (filter === 'benign') return !result.pathogenic;
                return true;
            });

            return (
                <div className="component-container">
                    <h2>{t.mutationAnalyzer}</h2>
                    <div style={{ marginBottom: '16px' }}>
                        <label>{t.proteinSequence}</label>
                        <textarea
                            className="sequence-input"
                            style={{ height: '80px' }}
                            value={proteinSequence}
                            onChange={(e) => setProteinSequence(e.target.value.toUpperCase())}
                        />
                    </div>
                    <div style={{ marginBottom: '16px' }}>
                        <label>{t.mutations} (pl. A123V, G456D):</label>
                        <input
                            type="text"
                            className="sequence-input"
                            style={{ height: '40px' }}
                            value={mutations}
                            onChange={(e) => setMutations(e.target.value)}
                            placeholder="A123V, G456D, ..."
                        />
                    </div>
                    <button 
                        className="btn btn-primary" 
                        onClick={analyzeMutations}
                        disabled={!proteinSequence || !mutations}
                    >
                        Analyze Mutations
                    </button>

                    {results.length > 0 && (
                        <>
                            <div className="filter-controls">
                                <button 
                                    className={`btn ${filter === 'all' ? 'btn-primary' : ''}`}
                                    onClick={() => setFilter('all')}
                                >
                                    All ({results.length})
                                </button>
                                <button 
                                    className={`btn ${filter === 'pathogenic' ? 'btn-primary' : ''}`}
                                    onClick={() => setFilter('pathogenic')}
                                >
                                    Pathogenic ({results.filter(r => r.pathogenic).length})
                                </button>
                                <button 
                                    className={`btn ${filter === 'benign' ? 'btn-primary' : ''}`}
                                    onClick={() => setFilter('benign')}
                                >
                                    Benign ({results.filter(r => !r.pathogenic).length})
                                </button>
                            </div>
                            
                            <table className="mutation-table">
                                <thead>
                                    <tr>
                                        <th>Mutation</th>
                                        <th>{t.pathogenicity}</th>
                                        <th>{t.confidence}</th>
                                        <th>Clinical Significance</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredResults.map((result, index) => (
                                        <tr key={index}>
                                            <td>{result.mutation}</td>
                                            <td>
                                                <span className={`pathogenicity-score ${getScoreClass(result.pathogenicity_score)}`}>
                                                    {(result.pathogenicity_score * 100).toFixed(1)}%
                                                </span>
                                            </td>
                                            <td>{result.confidence}</td>
                                            <td>{result.clinical_significance}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </>
                    )}
                </div>
            );
        }

        // Kód Generátor Komponens
        function CodeGenerator() {
            const [description, setDescription] = useState('');
            const [language, setLanguage] = useState('python');
            const [generatedCode, setGeneratedCode] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const editorRef = useRef(null);

            useEffect(() => {
                if (generatedCode && !editorRef.current) {
                    const editor = CodeMirror(document.getElementById('code-editor'), {
                        value: generatedCode,
                        mode: language,
                        theme: 'dracula',
                        lineNumbers: true,
                        readOnly: false
                    });
                    editorRef.current = editor;
                } else if (editorRef.current) {
                    editorRef.current.setValue(generatedCode);
                    editorRef.current.setOption('mode', language);
                }
            }, [generatedCode, language]);

            const generateCode = async () => {
                setIsGenerating(true);
                try {
                    const response = await fetch('/api/code/generate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt: description,
                            language: language,
                            complexity: 'medium'
                        })
                    });
                    const result = await response.json();
                    setGeneratedCode(result.generated_code || '');
                } catch (error) {
                    console.error('Code generation error:', error);
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="component-container">
                    <h2>Kód Generátor</h2>
                    <div style={{ marginBottom: '16px' }}>
                        <label>Nyelv:</label>
                        <select 
                            value={language} 
                            onChange={(e) => setLanguage(e.target.value)}
                            className="btn"
                            style={{ marginLeft: '8px' }}
                        >
                            <option value="python">Python</option>
                            <option value="javascript">JavaScript</option>
                            <option value="java">Java</option>
                            <option value="cpp">C++</option>
                        </select>
                    </div>
                    <textarea
                        className="sequence-input"
                        placeholder="Írja le, milyen kódot szeretne generálni..."
                        value={description}
                        onChange={(e) => setDescription(e.target.value)}
                        style={{ height: '100px' }}
                    />
                    <button 
                        className="btn btn-primary" 
                        onClick={generateCode}
                        disabled={!description || isGenerating}
                        style={{ marginTop: '16px', marginBottom: '16px' }}
                    >
                        {isGenerating ? 'Generating...' : 'Kód generálása'}
                    </button>
                    {generatedCode && (
                        <div className="code-editor-container">
                            <div id="code-editor"></div>
                        </div>
                    )}
                </div>
            );
        }

        // 3D Kontakt Térkép Komponens
        function ContactMapViewer() {
            const [mapData, setMapData] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const canvasRef = useRef(null);

            const loadContactMap = async () => {
                setIsLoading(true);
                try {
                    // Mock data for demonstration
                    const mockData = {
                        size: 50,
                        contacts: []
                    };
                    
                    // Generate mock contact map data
                    for (let i = 0; i < mockData.size; i++) {
                        for (let j = i; j < mockData.size; j++) {
                            const distance = Math.abs(i - j);
                            const contact = Math.exp(-distance / 10) * Math.random();
                            if (contact > 0.3) {
                                mockData.contacts.push({
                                    i, j, contact: contact
                                });
                            }
                        }
                    }
                    
                    setMapData(mockData);
                    renderContactMap(mockData);
                } catch (error) {
                    console.error('Contact map loading error:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            const renderContactMap = (data) => {
                const canvas = canvasRef.current;
                if (!canvas || !data) return;

                const ctx = canvas.getContext('2d');
                const size = 400;
                canvas.width = size;
                canvas.height = size;

                // Clear canvas
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, size, size);

                // Draw contact map
                const scale = size / data.size;
                data.contacts.forEach(contact => {
                    const x = contact.i * scale;
                    const y = contact.j * scale;
                    const intensity = contact.contact;
                    
                    ctx.fillStyle = `rgba(57, 255, 20, ${intensity})`;
                    ctx.fillRect(x, y, scale, scale);
                    
                    // Mirror across diagonal
                    if (contact.i !== contact.j) {
                        ctx.fillRect(y, x, scale, scale);
                    }
                });

                // Add grid lines
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                for (let i = 0; i <= data.size; i += 5) {
                    const pos = i * scale;
                    ctx.beginPath();
                    ctx.moveTo(pos, 0);
                    ctx.lineTo(pos, size);
                    ctx.moveTo(0, pos);
                    ctx.lineTo(size, pos);
                    ctx.stroke();
                }
            };

            return (
                <div className="component-container">
                    <h2>3D Kontakt Térképek</h2>
                    <button 
                        className="btn btn-primary" 
                        onClick={loadContactMap}
                        disabled={isLoading}
                        style={{ marginBottom: '16px' }}
                    >
                        {isLoading ? 'Loading...' : 'Kontakt térkép betöltése'}
                    </button>
                    <div className="contact-map-container">
                        <canvas 
                            ref={canvasRef}
                            style={{ width: '100%', height: '100%', objectFit: 'contain' }}
                        />
                    </div>
                </div>
            );
        }

        // Dashboard Komponens
        function Dashboard() {
            const [analyses, setAnalyses] = useState([]);
            const [language, setLanguage] = useState('hu');

            const t = translations[language];

            useEffect(() => {
                const langSelect = document.getElementById('languageSelect');
                const handleLanguageChange = (e) => setLanguage(e.target.value);
                langSelect.addEventListener('change', handleLanguageChange);
                return () => langSelect.removeEventListener('change', handleLanguageChange);
            }, []);

            useEffect(() => {
                // Mock running analyses
                setAnalyses([
                    {
                        id: 1,
                        type: 'AlphaFold3 Analysis',
                        progress: 75,
                        status: 'running',
                        startTime: new Date(Date.now() - 300000) // 5 minutes ago
                    },
                    {
                        id: 2,
                        type: 'Mutation Analysis',
                        progress: 100,
                        status: 'completed',
                        startTime: new Date(Date.now() - 600000) // 10 minutes ago
                    },
                    {
                        id: 3,
                        type: 'Genome Analysis',
                        progress: 45,
                        status: 'running',
                        startTime: new Date(Date.now() - 120000) // 2 minutes ago
                    }
                ]);
            }, []);

            const getStatusColor = (status) => {
                switch (status) {
                    case 'running': return 'var(--primary)';
                    case 'completed': return 'var(--secondary)';
                    case 'error': return '#ff3b30';
                    default: return 'var(--text-muted)';
                }
            };

            return (
                <div className="component-container">
                    <h2>{t.dashboard}</h2>
                    <div className="dashboard-grid">
                        <div className="dashboard-card">
                            <h3>{t.runningAnalyses}</h3>
                            {analyses.map(analysis => (
                                <div key={analysis.id} style={{ marginBottom: '16px' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                        <span>{analysis.type}</span>
                                        <span style={{ color: getStatusColor(analysis.status) }}>
                                            {analysis.status === 'running' ? `${analysis.progress}%` : analysis.status}
                                        </span>
                                    </div>
                                    <div className="progress-bar">
                                        <div 
                                            className="progress-fill" 
                                            style={{ width: `${analysis.progress}%` }}
                                        />
                                    </div>
                                    <small style={{ color: 'var(--text-muted)' }}>
                                        Started: {analysis.startTime.toLocaleTimeString()}
                                    </small>
                                </div>
                            ))}
                        </div>
                        
                        <div className="dashboard-card">
                            <h3>Gyors statisztikák</h3>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>
                                <div style={{ textAlign: 'center' }}>
                                    <div style={{ fontSize: '2rem', fontWeight: 'bold', color: 'var(--primary)' }}>24</div>
                                    <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Mai elemzések</div>
                                </div>
                                <div style={{ textAlign: 'center' }}>
                                    <div style={{ fontSize: '2rem', fontWeight: 'bold', color: 'var(--secondary)' }}>156</div>
                                    <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Összes elemzés</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Komponensek renderelése
        ReactDOM.render(<SequenceAnalyzer />, document.getElementById('sequence-analyzer'));
        ReactDOM.render(<MutationAnalyzer />, document.getElementById('mutation-analyzer'));
        ReactDOM.render(<CodeGenerator />, document.getElementById('code-generator'));
        ReactDOM.render(<ContactMapViewer />, document.getElementById('contact-map-viewer'));
        ReactDOM.render(<Dashboard />, document.getElementById('dashboard'));
    </script>
</body>
</html>
